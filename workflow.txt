### Run Phred
phred -id ./all_plate_ab1  -sa all_out.fasta -qa all_out.q

### Open juypter notebook
jupyter notebook --notebook-dir=Y:/

### Run Python Script to convert Phred Scores to Real Q score
phred_fix_fasta.ipynb

### Activate Conda Env with fastp installed
conda activate sanger_basecalling

## Run Fastp to trim out poor quality sequences
fastp -Q -L -5 -3 --max_len1 800 --cut_front_mean_quality 25 --cut_tail_mean_quality 25 -i All_16s_fix_2.fastq -o All_16s_fix_2_trim_25.fastq

## Run RDP
Not a great data base & classifier

## Classifying with Qiime2 & 16s-ITGDB

1. Install conda enviroment w/ correct version of qiime2 for the provied trained qiime2 database from yphsieh/16S-ITGDB
	wget https://data.qiime2.org/distro/core/qiime2-2022.11-py38-linux-conda.yml
	conda env create -n qiime2-2022.11 --file qiime2-2022.11-py38-linux-conda.yml
	conda activate qiime2-2022.11

2. Download correct DB in qiime2 artifact format from yphsieh/16S-ITGDB google drive
	taxa_itgdb_q2_2022_11_clf.qza

3. Convert Fastq to Fasta
	sed -n '1~4s/^@/>/p;2~4p' All_16s_fix_2_trim_25.fastq > All_16s_fix_2_trim_25.fasta

4. Import DB to qiime2 
	qiime tools import --type 'FeatureData[Sequence]' --input-path All_16s_fix_2_trim_25.fasta  --output-path All_16s_fix_2_trim_25.qza

5. Assign Taxonomy
	qiime feature-classifier classify-sklearn --i-classifier taxa_itgdb_q2_2022_11_clf.qza --i-reads All_16s_fix_2_trim_25.qza --o-classification All_16s_fix_classification.qza --p-n-jobs 10 --p-confidence 90

6. Export taxonomy as TSV
	qiime tools export --input-path All_16s_fix_classification.qza --output-path All_16s_qiime2_itgdb_90.tsv


## Turning off confidence

5. Assign Taxonomy
	qiime feature-classifier classify-sklearn --i-classifier taxa_itgdb_q2_2022_11_clf.qza --i-reads All_16s_fix_2_trim_25.qza --o-classification All_16s_fix_classification_d.qza --p-n-jobs 10 --p-confidence disable

6. Export taxonomy as TSV
	qiime tools export --input-path All_16s_fix_classification_d.qza --output-path All_16s_qiime2_itgdb_d.tsv


## Trying at 70%

5. Assign Taxonomy
	qiime feature-classifier classify-sklearn --i-classifier taxa_itgdb_q2_2022_11_clf.qza --i-reads All_16s_fix_2_trim_25.qza --o-classification All_16s_fix_classification_7.qza --p-n-jobs 10 --p-confidence .7

6. Export taxonomy as TSV
	qiime tools export --input-path All_16s_fix_classification_7.qza --output-path All_16s_qiime2_itgdb_7.tsv



## Trying at 80%

5. Assign Taxonomy
	qiime feature-classifier classify-sklearn --i-classifier taxa_itgdb_q2_2022_11_clf.qza --i-reads All_16s_fix_2_trim_25.qza --o-classification All_16s_fix_classification_8.qza --p-n-jobs 10 --p-confidence .8

6. Export taxonomy as TSV
	qiime tools export --input-path All_16s_fix_classification_8.qza --output-path All_16s_qiime2_itgdb_8.tsv